#!/usr/bin/env bash

ENV_DEFAULT=.env.local
ENV_FALLBACK=.env

function stop_server() {
    symfony server:stop
}

function start_server() {
    args_extra="$@"

    symfony server:start -d $args_extra
}

if [[ -f $ENV_DEFAULT ]]; then
    source $ENV_DEFAULT
elif [[ -f $ENV_FALLBACK ]]; then
    source $ENV_FALLBACK
fi

start_server_args=""

if [[ ! -z $SERVER_PORT ]] && [[ $SERVER_PORT != 1 ]]; then
    start_server_args="$start_server_args --no-tls"
fi

if [[ ! -z $SERVER_PORT ]]; then
    start_server_args="$start_server_args --port=$SERVER_PORT"
fi

stop_server
start_server "$start_server_args"